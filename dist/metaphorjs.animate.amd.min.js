define("metaphorjs-animate",["metaphorjs-promise"],function(A){function t(a,b){b&&(a.className=a.className.replace(w("(?:^|\\s)"+b+"(?!\\S)"),""))}function y(a){return"function"==typeof a}function J(a){if(!a)return!1;var b,c;return"object"!=(c=typeof a)&&"function"!=c?!1:y(b=a.then)?b:!1}function z(a){return"object"==typeof a&&3===B(a)&&!a.nodeType&&a.constructor===Object}function D(a){return!0===a||!1===a}function K(a,b,c,d){return setTimeout(function(){a.apply(b,c||[])},d||0)}function E(a,b){var c;
if(c=b)c=!(b&&w("(?:^|\\s)"+b+"(?!\\S)").test(a.className));c&&(a.className+=" "+b)}function C(a){return"string"==typeof a||a===""+a}var x=function(){var a=["Moz","Webkit","ms","O","Khtml"],b="animationDelay",c="animationDuration",d="transitionDelay",g="transitionDuration",h="transform",l=null,e=null,F=!1;return function(){if(!F){var m=window.document.createElement("div"),f=!1,r;if(void 0!==m.style.animationName)f=!0;else{var k=0;for(r=a.length;k<r;k++){var u=a[k];if(void 0!==m.style[u+"AnimationName"]){f=
!0;b=u+"AnimationDelay";c=u+"AnimationDuration";d=u+"TransitionDelay";g=u+"TransitionDuration";h=u+"Transform";break}}}f&&("ontransitionend"in window?l="transitionend":"onwebkittransitionend"in window&&(l="webkitTransitionEnd"));e=f?{animationDelay:b,animationDuration:c,transitionDelay:d,transitionDuration:g,transform:h,transitionend:l}:{};F=!0}return e}}(),G=function(){var a=function(a){if(!a)return 0;var b=parseFloat(a);-1===a.indexOf("ms")&&(b*=1E3);return b},b=function(b,c,m){var f,g=c.length;
for(f=0;f<g;f++){var d=a(c[f])+a(m[f]);b=Math.max(d,b)}return b},c=!1,d=null,g=null,h=null,l=null;return function(a){!1===c&&(d=(c=x())?c.animationDuration:null,g=c?c.animationDelay:null,h=c?c.transitionDuration:null,l=c?c.transitionDelay:null);if(!c)return 0;var e=window.getComputedStyle?window.getComputedStyle(a,null):a.style;a=0;var m=(e[d]||"").split(","),f=(e[g]||"").split(","),r=(e[h]||"").split(",");e=(e[l]||"").split(",");a=Math.max(a,b(a,m,f));return a=Math.max(a,b(a,r,e))}}(),L=function(){var a=
["0","0","0"];return function(){for(var b=a.length,c;b;){b--;c=a[b].charCodeAt(0);if(57==c)return a[b]="A",a.join("");if(90==c)a[b]="0";else return a[b]=String.fromCharCode(c+1),a.join("")}a.unshift("0");return a.join("")}}(),k=function(){var a={};return function(b,c,d){b=b._mjsid||(b._mjsid=L());var g=a[b];return void 0!==d?(g||(g=a[b]={}),g[c]=d):g?g[c]:void 0}}(),w=function(){var a={};return function(b){return a[b]||(a[b]=new RegExp(b))}}(),M=Object.prototype.toString,B=function(){var a={"[object String]":0,
"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(b){if(!b){if(null===b)return 6;if(void 0===b)return 7}var c=a[M.call(b)];return void 0===c?-1:1===c&&isNaN(b)?8:c}}(),N=function(a){var b=k(a,"mjsAnimationQueue");if("object"===typeof b&&5===B(b)&&b.length){if(b=b[0]){if(b.stages){var c=b.position;var d=b.stages;t(a,d[c]);t(a,d[c]+"-active")}b.deferred&&b.deferred.reject(b.el)}}else y(b)?b(a):
"stop"===b&&$(a).stop(!0,!0);k(a,"mjsAnimationQueue",null)},O=Array.prototype.slice,H=function(){return function b(){var c=!1,d=!1,g=O.call(arguments),h=g.shift(),l,e,k;D(g[g.length-1])&&(c=g.pop());D(g[g.length-1])&&(d=c,c=g.pop());for(;g.length;)if((l=g.shift())&&l.hasOwnProperty)for(e in l)if(l.hasOwnProperty(e)&&void 0!==(k=l[e]))if(d)if(h[e]&&z(h[e])&&z(k))b(h[e],k,c,d);else{if(!0===c||void 0==h[e])z(k)?(h[e]={},b(h[e],k,c,!0)):h[e]=k}else if(!0===c||void 0==h[e])h[e]=k;return h}}();(function(){var a=
[],b=function(b){var c;var g=0;for(c=a.length;g<c;g++)if(!1===a[g][0].call(a[g][1],b))return;g=(b?b.stack:null)||Error().stack;if("undefined"!=typeof console&&console.error)b&&console.error(b),g&&console.error(g);else throw b;};b.on=function(c,d){b.un(c,d);a.push([c,d])};b.un=function(b,d){var c;var h=0;for(c=a.length;h<c;h++)if(a[h][0]===b&&a[h][1]===d){a.splice(h,1);break}};return b})();var p=function(){if("undefined"!==typeof window){var a=window;var b=a.requestAnimationFrame||a.webkitRequestAnimationFrame||
a.mozRequestAnimationFrame;var c=a.cancelAnimationFrame||a.webkitCancelAnimationFrame||a.mozCancelAnimationFrame||a.webkitCancelRequestAnimationFrame;if(b)return function(a,g,h){var d=b(g||h?function(){a.apply(g,h||[])}:a);return function(){c(d)}}}return function(a,b,c){var g=K(a,b,c,0);return function(){clearTimeout(g)}}}();return function(){var a={show:["mjs-show"],hide:["mjs-hide"],enter:["mjs-enter"],leave:["mjs-leave"],move:["mjs-move"]},b=0,c=!1,d=!1,g=function(a,b,c){var f=function(){(new Date).getTime()-
b>=c?a():p(f)};p(f)},h=function(){!1===c&&(c=x(),d=!!c);return d},l=function n(a,b,c,d,e,h,I,q){var f=function(){var b=k(a,"mjsAnimationQueue");return b&&b.length&&b[0].id==I?!1:(e.reject(a),!0)},m=function(){if(!f()){var g=c;c++;if(c===b.length){e.resolve(a);k(a,"mjsAnimationQueue").shift();var d=k(a,"mjsAnimationQueue");d.length?(d=d[0],l(d.el,d.stages,0,d.start,d.deferred,!1,d.id,d.step)):k(a,"mjsAnimationQueue",null)}else k(a,"mjsAnimationQueue")[0].position=c,n(a,b,c,null,e,!1,I,q);t(a,b[g]);
t(a,b[g]+"-active")}},u=function(){f()||(E(a,b[c]+"-active"),A.resolve(q&&q(a,c,"active")).done(function(){if(!f()){var b=G(a);b?g(m,(new Date).getTime(),b):p(m)}}))},r=function(){f()||(E(a,b[c]),A.waterfall([q&&q(a,c,"start"),function(){return d?d(a):null}]).done(function(){!f()&&p(u)}))};h?p(r):r()},e=function(c,f,d,g){var e=new A,m=k(c,"mjsAnimationQueue")||[],r=++b;if(f){if(C(f))var q=a[f];else if(y(f))var n=f;else if("object"===typeof f&&5===B(f))if(C(f[0]))q=f;else{var p=f[0];var t=f[1]}if(z(f)){q=
f.stages;n=f.fn;p=f.before;t=f.after;var v=f.options?H({},f.options):{};var x=f.context||null;var w=f.duration||null;d=d||v.start}if(h()&&q)return m.push({el:c,stages:q,start:d,step:g,deferred:e,position:0,id:r}),k(c,"mjsAnimationQueue",m),1===m.length&&l(c,q,0,d,e,!0,r,g),e;v=v||{};d&&(v.start=function(){d(c)});v.complete=function(){e.resolve(c)};w&&(v.duration=w);if(n&&y(n))return p&&H(c.style,p,!0,!1),d&&d(c),k(c,"mjsAnimationQueue",n.call(x,c,function(){e.resolve(c)})),e;if(window.jQuery){f=$(c);
p&&f.css(p);k(c,"mjsAnimationQueue","stop");if(n&&C(n))return f[n](v),e;if(t)return f.animate(t,v),e}}d?(n=d(c),J(n)?n.done(function(){e.resolve(c)}):e.resolve(c)):e.resolve(c);return e};e.addAnimationType=function(b,c){a[b]=c};e.stop=N;e.getPrefixes=x;e.getDuration=G;e.cssAnimationSupported=h;return e}()});
